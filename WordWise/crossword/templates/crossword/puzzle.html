{% load static %}

{% block content %}
<div class="container mx-auto px-8 py-8">
    <h1 class="text-2xl font-bold mb-4 text-center">Welcome to Crossword Game</h1>

    <div class="game-box">
        <!-- กริด crossword ขนาด 15x15 -->
        <div class="crossword-grid" id="crosswordGrid"></div>

        <!-- ตารางคำใบ้ -->
        <div class="hint-container">
            <h2 class="text-2xl font-bold mb-4" id="title-hint">Hint Table</h2>
            <div class="hint-table" id="hintTable">
                {% for word in words %}
                    <div class="hint-item" data-word="{{ word.word }}">
                        <strong>{{forloop.counter}}.</strong>{{word.meaning }}
                    </div>
                    <div class="hint-item" data-word="{{ word.word }}">
                        {{ word.word }}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- ปุ่มเช็คคำตอบ -->
    <button id="checkButton" class="mt-4 px-4 py-2 bg-blue-500 text-white">Check</button>
</div>

<style>
    /* สไตล์การจัดตาราง */
    .game-box {
        display: flex;
        gap: 20px;
        margin-top: 20px;
    }

    .container {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* กริด crossword ขนาด 15x15 */
    .crossword-grid {
        display: grid;
        grid-template-columns: repeat(15, 30px);
        grid-template-rows: repeat(15, 30px);
        gap: 1px;
        background-color: #000;
        padding: 1px;
        border: 2px solid green;
    }

    /* เซลล์กริด */
    .grid-cell {
        width: 30px;
        height: 30px;
        background-color: #fff;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* การจัดการ input */
    .grid-cell input {
        width: 100%;
        height: 100%;
        border: none;
        text-align: center;
        font-size: 16px;
        text-transform: uppercase;
        background: transparent;
        outline: none;
    }

    .grid-cell input:focus {
        background-color: #e6f3ff; /* สีพื้นหลังเมื่อมีการกรอกข้อมูล */
    }

    .selected {
        background-color: #e6f3ff; /* สีพื้นหลังเมื่อเลือกเซลล์ */
    }

    /* ตารางคำใบ้ */
    .hint-container {
        width: 400px;
        margin-left: 40px;
    }

    .hint-table {
        background: wheat;
        width: 400px;
        height: 400px;
        overflow-y: auto;
    }

    .hint-item {
        color: black;
        text-align: left;
        padding: 20px;
        font-size: 18px;
    }

    #title-hint {
        text-align: center;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const gridSize = 15;
    const grid = document.getElementById('crosswordGrid');

    let cells = {}; // เก็บเซลล์ทั้งหมดเพื่อใช้งานภายหลัง
    let usedPositions = new Set(); // ตรวจสอบตำแหน่งที่ถูกใช้แล้ว

    // สร้างเซลล์กริดขนาด 15x15
    for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.dataset.x = j;
            cell.dataset.y = i;

            const input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.pattern = "[A-Za-z]";
            input.title = "Only English letters allowed";
            input.addEventListener('input', function(e) {
                if (!/^[a-zA-Z]$/.test(e.target.value)) {
                    e.target.value = "";
                }
            });

            cell.appendChild(input);
            grid.appendChild(cell);
            cells[`${i},${j}`] = cell;
        }
    }

    // ดึงข้อมูล words จาก Django template
    const words = [];
    document.querySelectorAll('.hint-item').forEach(hint => {
        words.push(hint.dataset.word);
    });

    // ฟังก์ชันสุ่มตำแหน่งที่ยังไม่ถูกใช้
    function getRandomPosition() {
        let row, col;
        do {
            row = Math.floor(Math.random() * gridSize);
            col = Math.floor(Math.random() * gridSize);
        } while (usedPositions.has(`${row},${col}`));
        usedPositions.add(`${row},${col}`);
        return { row, col };
    }

    // กำหนดหมายเลขให้กับ crossword grid
    words.forEach((word, index) => {
        let { row, col } = getRandomPosition();
        let cell = cells[`${row},${col}`];

        if (cell) {
            const label = document.createElement('div');
            label.innerText = index + 1; // หมายเลขคำใบ้
            label.style.position = 'absolute';
            label.style.fontSize = '10px';
            label.style.color = 'black';
            label.style.top = '2px';
            label.style.left = '2px';

            cell.style.position = 'relative';
            cell.appendChild(label);
        }
    });
});

</script>
{% endblock %}
